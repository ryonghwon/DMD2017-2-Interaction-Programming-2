<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<title>Parallax Scroll</title>
<link rel="stylesheet" href="./css/style.css">
<script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/1.20.3/TweenMax.min.js"></script>
</head>
<body>
<div id="wrap">
    <div class="section">
        <div class="image-area">
            <img src="./img/0.jpg">
        </div>
        <div class="text-area">
            <p class="title">Section 0</p>
            <p class="desc">움직이지 않는 구간</p>
        </div>
    </div>
    <div class="section">
        <div class="image-area">
            <img src="./img/1.jpg">
        </div>
        <div class="text-area">
            <p class="title">Section 1</p>
            <p class="desc">글씨가 위아래</p>
        </div>
    </div>
    <div class="section">
        <div class="image-area">
            <img src="./img/2.jpg">
        </div>
        <div class="text-area">
            <p class="title">Section 2</p>
            <p class="desc">이번엔 옆으로 슉</p>
        </div>
    </div>
    <div class="section">
        <div class="image-area">
            <img src="./img/3.jpg">
        </div>
        <div class="text-area">
            <p class="title">Section 3</p>
            <p class="desc">이미지 스르륵</p>
        </div>
    </div>
    <div class="section">
        <div class="image-area">
            <img src="./img/4.jpg">
        </div>
        <div class="text-area">
            <p class="title">Section 4</p>
            <p class="desc">XY축 다 움직여라</p>
        </div>
    </div>
</div>
<script type="text/javascript">

$(document).ready(function(){
  var $win = $(window), $wrap = $('#wrap'), $section = $('.section'), _winH, _max = $section.length;

  $.each($section, function(i, d){
    var $el = $(d);
    $el.css({'z-index' :_max -i})
  })

  $win.on({'scroll':function(){
    parallax();//스크롤시 parallax 함수실행
  },
  'resize':function(){
    //리사이즈시 wrap 사이즈조절
    _winH = $win.height();
    _winW = $win.width();
    $wrap.height(_winH * _max)
    parallax();
  }
  });

  var parallax = function(){
    var scrollTop = $win.scrollTop();//스크롤시 위치
    $.each($section, function(i, d){
      // var $el = $(d), limitT = $el.offset().top, limitB = limitT + _winH, elY;
      var $el = $(d), $img = $el.find('img'),$title = $el.find('.title'), $desc = $el.find('.desc'),
      limitT = _winH * i, limitB = limitT + _winH, elY, imgX, imgY, titleY, descY, descX;
      limitF = _winW;

      if(scrollTop > limitT - _winH && scrollTop <= limitB){
        // console.log(i, scrollTop, limitT, limitB);
        elY = limitT - scrollTop;
        elX = limitF - scrollTop; 
        $el.css({'transform':'translate3d(0,'+ elY + 'px, 0)'});

        if(i > 0){
            if(i == 0){
              imgX = 0;
              imgY = elY * -1;
              titleX = 0;
              titleY = 0;
              descY = 0;
              descX = 0;
            }else if(i == 1){
              //2일때
              imgX = 0;
              imgY = elY /2 * -1;
              titleX = 0;
              titleY = Math.min(elY /3);
              descY = Math.max(elY / 5);
              descX = 0;
            }else if(i == 2){
              //3일때
              imgX = 0;
              imgY = elY /2 * -1;
              titleX = Math.min(elX * 2);
              titleY = 0;
              descY = 0;
              descX = Math.max(-elX * 2);
            }else if(i == 3){
              //4일때
              imgX = elY /10 * -1;
              imgY = elY /2 * -1;
              titleX = 0;
              titleY = Math.min(elY /3);
              descY = Math.max(elY / 5);
              descX = 0;
            }else if(i == 4){
              //5일때
              imgX = elY /10;
              imgY = elY /2 * -1;
              titleX = Math.min(elY /2);
              titleY = Math.min(elY /-3);
              descY = Math.max(elY / 2);
              descX = Math.max(elY /-2);
            }

            $img.css({'transform':'translate3d('+ imgX + 'px,'+ imgY + 'px, 0)'});
            $title.css({'transform':'translate3d('+ titleX + 'px,'+ titleY + 'px, 0)'});
            $desc.css({'transform':'translate3d('+ descX + 'px,' + descY + 'px, 0)'});
        }else{

        }
      }else{
        $el.css({'transform':'translate3d(0,100vh,0)'});
        $img.css({'transform':'translate3d(0, 0, 0)'});
        if(i > 0){
          $title.css({'transform':'translate3d(0, 0, 0)'});
          $desc.css({'transform':'translate3d(0, 0, 0)'});
        }
      }
    })
  };        //  Math.min(0, value);//음수값일때만 불러오는, 양수일때에는 0만 출력
          //  Math.max();//양수값일때만 불러오는, 음수일때에는 0만 출력
  $win.trigger('resize');
});
</script>
</body>
</html>
